---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const totalWords = posts.reduce((acc, post) => acc + (post.data.wordCount || 0), 0);
---

<Layout title="Blog - Yuvraj Biswal">
  <div class="space-y-10">
    <section>
      <h1 class="section-heading text-[28px] mb-3">Blog</h1>
      <p class="text-[var(--text-secondary)] leading-relaxed">
        Writing about systems programming, physics, deep learning, and the tools I build.
      </p>
    </section>

    <!-- Posts List -->
    <section>
      {posts.map((post) => {
        const formattedDate = post.data.date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
        });

        return (
          <a href={`/blog/${post.slug}`} class="blog-card">
            <div class="blog-card-title">{post.data.title}</div>
            <div class="blog-card-excerpt">{post.data.description}</div>
            <div class="blog-card-meta">
              <time datetime={post.data.date.toISOString()}>{formattedDate}</time>
              {post.data.wordCount && (
                <span> · {post.data.wordCount.toLocaleString()} words</span>
              )}
              {post.data.tags.length > 0 && (
                <span> · {post.data.tags.join(', ')}</span>
              )}
            </div>
          </a>
        );
      })}

      {posts.length === 0 && (
        <p class="text-[var(--text-muted)] italic">No posts yet. Check back soon.</p>
      )}
    </section>
  </div>
</Layout>
